---
layout: single
title: "Chair Audio Player 1"
permalink: /chair-audio/
---

<style>
  .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin: 12px 0; }
  button { padding: 10px 12px; font-size: 16px; }
  .sent { width: 100%; text-align: left; margin: 6px 0; }
  .active { outline: 3px solid #000; }
  input[type="range"] { width: 220px; }
  #status { margin: 10px 0; }
</style>

<h2>Script Player</h2>

<div class="row">
    <button id="prev" type="button">Prev</button>
    <button id="play" type="button">Play</button>
    <button id="next" type="button">Next</button>
    <button id="stop" type="button">Stop</button>
    <button id="test" type="button">Test Voice</button>
  <label>Speed: <span id="rateLabel">1.0</span></label>
  <input id="rate" type="range" min="0.6" max="1.6" value="1.0" step="0.05" />
</div>

<div id="status" aria-live="polite"></div>
<div id="list"></div>

<script>
  const sentences = [
    "You are building a dining chair without armrests.",
    "The build starts with two identical side frames.",
    "Each side frame has a tall leg and a short leg, and two fixed rails between them.",
    "Now connect the two side frames with three cross pieces.",
    "First, attach the backrest between the tops of the two tall legs.",
    "Second, attach the mid-height rail between the same tall legs, above seat height.",
    "Third, attach the seat-height rail between the two short legs.",
    "After that, the seat attaches onto the closed rim at seat height."
  ];

  let idx = 0;
  const synth = window.speechSynthesis;
  let voices = [];

  const list = document.getElementById("list");
  const rateSlider = document.getElementById("rate");
  const rateLabel = document.getElementById("rateLabel");
  const statusEl = document.getElementById("status");

  function setStatus(msg) { statusEl.textContent = msg; }

  function ensureSpeechSupported() {
    if (!("speechSynthesis" in window) || !("SpeechSynthesisUtterance" in window)) {
      setStatus("This browser doesn't support text-to-speech. Try Chrome, Edge, or Safari.");
      return false;
    }
    return true;
  }

  function loadVoices() {
    try { voices = synth.getVoices() || []; } catch(e) { voices = []; }
  }
  loadVoices();
  if ("onvoiceschanged" in synth) synth.onvoiceschanged = () => loadVoices();

  function highlight(i) {
    [...document.querySelectorAll(".sent")].forEach((b, k) => b.classList.toggle("active", k === i));
  }

  function stopAll() {
    try { synth.cancel(); } catch(e) {}
    setStatus("Stopped.");
  }

  // Speak one sentence reliably
  function speakOne(i) {
    if (!ensureSpeechSupported()) return;

    // Cancel + resume fixes “no sound” on Chrome/Safari sometimes
    try { synth.cancel(); } catch(e) {}
    try { synth.resume(); } catch(e) {}

    const u = new SpeechSynthesisUtterance(sentences[i]);
    u.rate = parseFloat(rateSlider.value);

    loadVoices();
    if (voices.length) u.voice = voices[0];

    u.onstart = () => { idx = i; highlight(i); setStatus("Speaking: " + (i+1)); };
    u.onerror = (e) => setStatus("TTS error: " + (e.error || "unknown"));

    // Tiny delay avoids “cancel then speak does nothing”
    setTimeout(() => synth.speak(u), 60);
  }

  // Play sequence using onend (more reliable than queueing a loop)
  let playing = false;
  function playFrom(i) {
    if (!ensureSpeechSupported()) return;
    playing = true;

    const u = new SpeechSynthesisUtterance(sentences[i]);
    u.rate = parseFloat(rateSlider.value);

    loadVoices();
    if (voices.length) u.voice = voices[0];

    u.onstart = () => { idx = i; highlight(i); setStatus("Playing: " + (i+1) + "/" + sentences.length); };
    u.onerror = (e) => { playing = false; setStatus("TTS error: " + (e.error || "unknown")); };
    u.onend = () => {
      if (!playing) return;
      if (i < sentences.length - 1) playFrom(i + 1);
      else { playing = false; setStatus("Done."); }
    };

    try { synth.cancel(); } catch(e) {}
    try { synth.resume(); } catch(e) {}
    setTimeout(() => synth.speak(u), 60);
  }

  // Build sentence buttons
  sentences.forEach((s, i) => {
    const b = document.createElement("button");
    b.className = "sent";
    b.textContent = (i + 1) + ". " + s;
    b.onclick = () => { playing = false; speakOne(i); };
    list.appendChild(b);
  });
  highlight(idx);
  setStatus("Ready. Click “Test Voice” first if your browser is picky.");

  document.getElementById("test").onclick = () => { playing = false; speakOne(idx); };
  document.getElementById("play").onclick = () => playFrom(idx);
  document.getElementById("prev").onclick = () => { playing = false; idx = Math.max(0, idx - 1); speakOne(idx); };
  document.getElementById("next").onclick = () => { playing = false; idx = Math.min(sentences.length - 1, idx + 1); speakOne(idx); };
  document.getElementById("stop").onclick = () => { playing = false; stopAll(); };

  rateSlider.oninput = () => { rateLabel.textContent = rateSlider.value; };
</script>
